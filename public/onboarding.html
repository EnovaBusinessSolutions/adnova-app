<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Onboarding - ADNOVA AI</title>

  <link rel="stylesheet" href="onboarding.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />

  <style>
    /* Helpers ligeros */
    .hidden{display:none!important}
    .notice{
      margin-top:12px;padding:10px 12px;border:1px solid #3a3a48;border-radius:8px;
      background:#16161f;color:#e7e7f0;font-size:.95rem;
    }

    /* Más aire en la grilla y tarjetas */
    .connection-cards { display: grid; gap: 22px; }
    .connection-card  { padding: 18px; border-radius: 14px; }

    /* MCC help (alineado con onboarding.js) */
    .mcc-help{
      margin-top:14px; padding:16px;
      border:1px dashed #6b61ff; border-radius:14px;
      background:linear-gradient(180deg, rgba(107,97,255,.08), rgba(107,97,255,.05));
    }
    .mcc-help__head{ display:flex; align-items:center; gap:10px; justify-content:space-between; margin-bottom:6px }
    .pill{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:.85rem; font-weight:600 }
    .pill--warn{ background:#3b2f14; color:#ffcf66; border:1px solid #6b561f }
    .pill--ok  { background:#123523; color:#7ee0a6; border:1px solid #1d5a3a }
    .mcc-help__reason{ opacity:.9; margin:.4rem 0 .6rem }
    .mcc-help__steps{ margin:.2rem 0 .8rem 1.2rem; line-height:1.5 }
    .mcc-help__actions{ display:flex; gap:10px; flex-wrap:wrap }
    .btn-secondary{ background:#1a1a24; border:1px solid #3a3a48 }
    .btn-secondary:hover{ background:#20202b }

    /* Aviso encima (status) */
    #ga-ads-status.notice { margin-top: 12px; margin-bottom: 10px }
  </style>
</head>

<body data-page="onboarding" data-user-id="USER_ID_REAL">
  <span id="shopifyConnectedFlag"  style="display:none">SHOPIFY_CONNECTED_FLAG</span>
  <span id="googleConnectedFlag"   style="display:none">GOOGLE_CONNECTED_FLAG</span>

  <div class="onboarding-container">
    <div class="sidebar">
      <div class="logo">
        <h1>ADNOVA/ai<span class="emoji"></span></h1>
      </div>

      <div class="steps">
        <div class="step active" data-step="1">
          <div class="step-indicator"><span class="step-number">1</span></div>
          <div class="step-text">
            <h3>Conecta tus cuentas</h3>
            <p>Agrega tu tienda y cuentas de marketing</p>
          </div>
        </div>
        <div class="step" data-step="2">
          <div class="step-indicator"><span class="step-number">2</span></div>
          <div class="step-text">
            <h3>Revisar permisos</h3>
            <p>Verifica y acepta los permisos requeridos</p>
          </div>
        </div>
        <div class="step" data-step="3">
          <div class="step-indicator"><span class="step-number">3</span></div>
          <div class="step-text">
            <h3>Análisis</h3>
            <p>Analizaremos los datos de tu tienda</p>
          </div>
        </div>
        <div class="step" data-step="4">
          <div class="step-indicator"><span class="step-number">4</span></div>
          <div class="step-text">
            <h3>Dashboard</h3>
            <p>Consulta los resultados de optimización</p>
          </div>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="content-panel" id="step1-content">
        <h2>Conecta tus cuentas</h2>
        <p class="panel-description">
          Conecta tu tienda online y plataformas de marketing para comenzar con ADNOVA AI.
        </p>

        <div class="connection-cards">
          <!-- Shopify -->
          <div class="connection-card">
            <div class="connection-details">
              <div class="connection-icon">
                <img src="https://img.icons8.com/ios-filled/50/FFFFFF/shopify.png" alt="Shopify" width="36" height="36" />
              </div>
              <div class="connection-info">
                <h3>Tienda de Shopify</h3>
                <p>Conecta tu tienda para optimizar el marketing</p>
                <span class="required-badge">Próximamente</span>
              </div>
            </div>

            <div class="btn-tooltip-wrapper coming-soon">
              <button type="button" class="btn-connect" id="connect-shopify-btn" aria-disabled="true" aria-describedby="shopify-tooltip" tabindex="-1">
                Conectar
              </button>
              <div class="btn-tooltip" id="shopify-tooltip" role="tooltip">
                <div class="btn-tooltip-title">Próximamente</div>
                <div class="btn-tooltip-desc">Estamos habilitando la conexión nativa con Shopify.</div>
              </div>
            </div>
          </div>

          <div id="shopify-domain-step" class="shop-step step--hidden">
            <label for="shop-domain-input">Escribe el dominio de tu tienda:</label>
            <div class="shop-input-row">
              <input id="shop-domain-input" placeholder="mitienda.myshopify.com" type="text" />
              <button id="shop-domain-send">Enviar</button>
            </div>
          </div>

          <style>
            .step--hidden{display:none}
            .shop-step{margin-top:18px}
            .shop-input-row{display:flex;gap:8px;margin-top:6px}
            #shop-domain-input{flex:1;padding:10px 14px;border-radius:6px;border:1px solid #444;background:#1e1e26;color:#fff;}
            #shop-domain-send{padding:10px 20px;border:0;border-radius:6px;cursor:pointer;background:#9a5bff;color:#fff;font-weight:600;}
            #shop-domain-send:hover{background:#8249e3}
          </style>

          <!-- Google -->
          <div class="connection-card" id="google-card">
            <div class="connection-details">
              <div class="connection-icon">
                <img src="https://img.icons8.com/ios-filled/50/FFFFFF/google-logo.png" alt="Google" width="36" height="36"/>
              </div>
              <div class="connection-info">
                <h3>Google Analytics & Ads</h3>
                <p>Importa datos de conversión y campañas</p>
                <span class="optional-badge">Beta</span>
              </div>
            </div>

            <button type="button" class="btn-connect" id="connect-google-btn">Conectar</button>

            <div id="google-obj">
              <style>
                #google-card { display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap; }
                #google-card .connection-details { flex:1 1 auto; }
                #google-card #connect-google-btn { flex:0 0 auto; margin-left:auto; }
                #google-card #google-obj { flex-basis:100%; order:99; }

                #google-obj #google-objective-step { display:none; margin-top:12px; }
                #google-obj .objective-title { display:block; margin-bottom:8px; font-weight:600; }
                #google-obj .objective-options { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
                #google-obj .option-chip{ border:1px solid #444; border-radius:10px; padding:8px 12px; background:#161616; color:#fff; display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none; transition:background .15s, border-color .15s;}
                #google-obj .option-chip:hover { background:#1b1b1b; border-color:#555; }
                #google-obj .option-chip input { accent-color:#8a5cff; }
                #google-obj .btn-connect.connected { background:#1c8a4b !important; }
                #google-obj .help { opacity:.75; margin-top:6px; font-size:.92rem; }
              </style>

              <div id="google-objective-step">
                <label class="objective-title">¿Qué objetivo te interesa optimizar en Google?</label>

                <div class="objective-options">
                  <label class="option-chip">
                    <input type="radio" name="googleObjective" value="ventas" />Ventas
                  </label>
                  <label class="option-chip">
                    <input type="radio" name="googleObjective" value="alcance" />Campañas de alcance
                  </label>
                  <label class="option-chip">
                    <input type="radio" name="googleObjective" value="leads" />Mensajes / Formulario
                  </label>
                </div>

                <button id="save-google-objective-btn" class="btn-connect">Guardar objetivo</button>
                <p class="help">Usaremos tu objetivo para personalizar el dashboard de Google.</p>
              </div>
            </div>

            <!-- Estado / selector (tu JS lo pinta) -->
            <div id="ga-ads-status" class="notice hidden" aria-live="polite"></div>
            <div id="ga-ads-accounts" class="hidden"></div>

            <!-- Panel MCC (solo si hace falta) -->
            <div id="google-mcc-help" class="mcc-help hidden" aria-live="polite">
              <div class="mcc-help__head">
                <strong>Conectar con nuestro MCC (solo si te lo pedimos)</strong>
                <span id="mcc-status-pill" class="pill pill--warn">Revisión requerida</span>
              </div>
              <p id="mcc-help-reason" class="mcc-help__reason">
                Tuvimos un problema al descubrir tus cuentas. Si ya aceptaste la invitación de administrador,
                pulsa <b>“Ya acepté, verificar”</b>. Si aún no la ves, te la podemos reenviar.
              </p>
              <ol class="mcc-help__steps">
                <li>Entra a Google Ads con tu cuenta.</li>
                <li>Ve a <b>Herramientas</b> → <b>Acceso y seguridad</b> → <b>Administradores</b>.</li>
                <li>Acepta la invitación del MCC <b>606-148-1297</b>.</li>
              </ol>
              <div class="mcc-help__actions">
                <button id="mcc-retry-btn"  class="btn-connect btn-secondary" type="button">Reintentar</button>
                <button id="mcc-verify-btn" class="btn-connect"               type="button">Ya acepté, verificar</button>
              </div>
            </div>
          </div>

          <!-- Meta -->
          <div class="connection-card" id="meta-card">
            <div class="connection-details">
              <div class="connection-icon">
                <img src="https://img.icons8.com/ios-filled/50/FFFFFF/facebook-new.png" alt="Meta" width="36" height="36" />
              </div>
              <div class="connection-info">
                <h3>Meta Business Manager</h3>
                <p>Conecta tus anuncios de Facebook e Instagram</p>
                <span class="optional-badge">Beta</span>
              </div>
            </div>

            <button type="button" class="btn-connect" id="connect-meta-btn">Conectar</button>

            <div id="meta-obj">
              <style>
                #meta-card { display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap; }
                #meta-card .connection-details { flex:1 1 auto; }
                #meta-card #connect-meta-btn { flex:0 0 auto; margin-left:auto; }
                #meta-card #meta-obj { flex-basis:100%; order:99; }
                #meta-obj #meta-objective-step { display:none; margin-top:12px; }
                #meta-obj .objective-title { display:block; margin-bottom:8px; font-weight:600; }
                #meta-obj .objective-options { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
                #meta-obj .option-chip { border:1px solid #444; border-radius:10px; padding:8px 12px; background:#161616; color:#fff; display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none; transition:background .15s, border-color .15s; }
                #meta-obj .option-chip:hover { background:#1b1b1b; border-color:#555; }
                #meta-obj .option-chip input { accent-color:#8a5cff; }
                #meta-obj .btn-connect.connected { background:#1c8a4b !important; }
                #meta-obj .help { opacity:.75; margin-top:6px; font-size:.92rem; }
              </style>

              <div id="meta-objective-step">
                <label class="objective-title">¿Qué objetivo te interesa optimizar?</label>

                <div class="objective-options">
                  <label class="option-chip">
                    <input type="radio" name="metaObjective" value="ventas" />Ventas
                  </label>
                  <label class="option-chip">
                    <input type="radio" name="metaObjective" value="alcance" />Campañas de alcance
                  </label>
                  <label class="option-chip">
                    <input type="radio" name="metaObjective" value="leads" />Mensajes / Leads
                  </label>
                </div>

                <button id="save-meta-objective-btn" class="btn-connect">Guardar objetivo</button>
                <p class="help">Usaremos tu objetivo para personalizar el dashboard de Meta Ads.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="bottom-actions">
          <button id="continue-btn" class="btn-continue btn-continue--disabled" disabled>Continuar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal selección de cuentas (máx 3 por plataforma) -->
  <div id="account-select-modal" class="hidden" role="dialog" aria-modal="true" aria-labelledby="asm-title">
    <div class="asm-overlay"></div>
    <div class="asm-panel">
      <h2 id="asm-title" class="asm-title">Selecciona tus cuentas</h2>
      <p class="asm-sub">
        Elige con qué cuentas quieres trabajar en Adnova AI.
        <strong>Máximo 3 por plataforma.</strong>
      </p>

      <div id="asm-hint"></div>
      <div id="asm-error" class="asm-error" style="display:none"></div>

      <h3 class="asm-section-title" id="asm-meta-title" style="display:none">
        Meta Business Manager
        <small>(<span id="asm-meta-count">0/3</span>)</small>
      </h3>
      <div id="asm-meta-list" class="asm-list"></div>

      <h3 class="asm-section-title" id="asm-google-title" style="display:none">
        Google Analytics & Ads
        <small>(<span id="asm-google-count">0/3</span>)</small>
      </h3>
      <div id="asm-google-list" class="asm-list"></div>

      <div class="asm-footer">
        <button id="asm-save" class="asm-btn asm-btn-primary" disabled>Guardar y continuar</button>
      </div>
    </div>
  </div>

  <!-- scripts -->
  <script type="module" src="/js/onboarding.js"></script>
  <script src="/js/onboardingInlineSelect.js" defer></script>
</body>
</html>
